{% extends 'base/base.html' %}
{% load static %}

{% block title %}Home | Campus Shoppy{% endblock %}

{% block content %}
<!-- Hero Section with Background Images -->
<section id="home-section" class="hero">
  <div class="home-slider" id="heroCarousel">
    <div class="slider-item active" style="background-image: url({% static 'images/happyMasenostudents.jpg' %})">
      <div class="overlay"></div>
      <div class="container">
        <div class="row slider-text justify-content-center align-items-center">
          <div class="col-md-12 text-center">
            <h1 class="mb-2">Welcome to Campus Shoppy</h1>
            <h2 class="subheading mb-4">
              We deliver to wherever you are Anytime, Anyplace. Create your account now!
            </h2>
            <p>
              <a href="{% url 'shop:shop' %}" class="btn btn-primary">View Details</a>
              <a href="{% url 'account:signup' %}" class="btn btn-outline-primary">Create Account</a>
            </p>
          </div>
        </div>
      </div>
    </div>

    <div class="slider-item" style="background-image: url({% static 'images/happy.jpg' %})">
      <div class="overlay"></div>
      <div class="container">
        <div class="row slider-text justify-content-center align-items-center">
          <div class="col-sm-12 text-center">
            <h1 class="mb-2">100% Quality Goods</h1>
            <h2 class="subheading mb-4">
              We deliver quality products to wherever you are. Create your account now!
            </h2>
            <p>
              <a href="{% url 'shop:shop' %}" class="btn btn-primary">View Details</a>
              <a href="{% url 'account:signup' %}" class="btn btn-outline-primary">Create Account</a>
            </p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Carousel Navigation -->
    <div class="carousel-nav">
      <button class="carousel-prev" onclick="changeSlide(-1)">
        <i class="fas fa-chevron-left"></i>
      </button>
      <button class="carousel-next" onclick="changeSlide(1)">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
    
    <!-- Carousel Dots -->
    <div class="carousel-dots">
      <span class="dot active" onclick="currentSlide(1)"></span>
      <span class="dot" onclick="currentSlide(2)"></span>
    </div>
  </div>
</section>

<!-- Services Section -->
<section class="ftco-section">
  <div class="container">
    <div class="row no-gutters ftco-services">
      <div class="col-md-3 text-center d-flex align-self-stretch ftco-animate">
        <div class="media block-6 services mb-md-0 mb-4">
          <div class="icon bg-color-1 active d-flex justify-content-center align-items-center mb-2">
            <span class="flaticon-shipped"></span>
          </div>
          <div class="media-body">
            <h3 class="heading">Free Shipping</h3>
            <span>On order over Ksh 2,000</span>
          </div>
        </div>
      </div>
      <div class="col-md-3 text-center d-flex align-self-stretch ftco-animate">
        <div class="media block-6 services mb-md-0 mb-4">
          <div class="icon bg-color-2 d-flex justify-content-center align-items-center mb-2">
            <span class="flaticon-diet"></span>
          </div>
          <div class="media-body">
            <h3 class="heading">Quality goods</h3>
            <span>Product always on good Quality</span>
          </div>
        </div>
      </div>
      <div class="col-md-3 text-center d-flex align-self-stretch ftco-animate">
        <div class="media block-6 services mb-md-0 mb-4">
          <div class="icon bg-color-3 d-flex justify-content-center align-items-center mb-2">
            <span class="flaticon-award"></span>
          </div>
          <div class="media-body">
            <h3 class="heading">Superior Quality</h3>
            <span>Quality Products</span>
          </div>
        </div>
      </div>
      <div class="col-md-3 text-center d-flex align-self-stretch ftco-animate">
        <div class="media block-6 services mb-md-0 mb-4">
          <div class="icon bg-color-4 d-flex justify-content-center align-items-center mb-2">
            <span class="flaticon-customer-service"></span>
          </div>
          <div class="media-body">
            <h3 class="heading">Support</h3>
            <span>24/7 Support</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Category Section with Background Images -->
<section class="ftco-section ftco-category ftco-no-pt">
  <div class="container">
    <div class="row">
      <div class="col-md-8">
        <div class="row">
          <div class="col-md-6 order-md-last align-items-stretch d-flex">
            <div class="category-wrap-2 ftco-animate img align-self-stretch d-flex" 
                 style="background-image: url({% static 'images/Africanvendor.jpg' %});">
              <div class="text text-center">
                <h2>Shop Everything</h2>
                <p>Get the best from the best</p>
                <p><a href="{% url 'shop:shop' %}" class="btn btn-primary">Shop now</a></p>
              </div>
            </div>
          </div>
          <div class="col-md-6">
            <div class="category-wrap ftco-animate img mb-4 d-flex align-items-end" 
                 style="background-image: url({% static 'images/shoe rack.webp' %})">
              <div class="text px-3 py-1">
                <h2 class="mb-0"><a href="{% url 'shop:shop' %}">Household Items</a></h2>
              </div>
            </div>
            <div class="category-wrap ftco-animate img d-flex align-items-end" 
                 style="background-image: url({% static 'images/Sayona woofers image.webp' %});">
              <div class="text px-3 py-1">
                <h2 class="mb-0"><a href="{% url 'shop:shop' %}">Sound Systems</a></h2>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="category-wrap ftco-animate img mb-4 d-flex align-items-end" 
             style="background-image: url({% static 'images/samsung phone.jpg' %})">
          <div class="text px-3 py-1">
            <h2 class="mb-0"><a href="{% url 'shop:shop' %}">Phones</a></h2>
          </div>
        </div>
        <div class="category-wrap ftco-animate img d-flex align-items-end" 
             style="background-image: url({% static 'images/kenyan watch.jpg' %})">
          <div class="text px-3 py-1">
            <h2 class="mb-0"><a href="{% url 'shop:shop' %}">Watches</a></h2>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Products Section -->
<section class="ftco-section">
  <div class="container">
    <div class="row justify-content-center mb-3 pb-3">
      <div class="col-md-12 heading-section text-center ftco-animate">
        <span class="subheading">Latest Products</span>
        <h2 class="mb-4">Our Products</h2>
        <p>Here you will get all the products available in our store</p>
      </div>
    </div>
  </div>
  <div class="container">
    <div class="row">
      {% if products %}
        {% for product in products %}
        <div class="col-md-6 col-lg-3 ftco-animate">
          <div class="product">
            <a href="{% url 'shop:product-details' product.id %}" class="img-prod">
              <img class="img-fluid" 
                   src="{% if product.image %}{{ product.image.url }}{% else %}{% static 'images/product-1.jpg' %}{% endif %}" 
                   alt="{{ product.name }}" />
              <div class="overlay"></div>
            </a>
            <div class="text py-3 pb-4 px-3 text-center">
              <h3>
                <a href="{% url 'shop:product-details' product.id %}">{{ product.name }}</a>
              </h3>
              <div class="d-flex">
                <div class="pricing">
                  <p class="price">
                    <span class="price-sale">Ksh {{ product.price }}</span>
                  </p>
                </div>
              </div>
              <div class="bottom-area d-flex px-3">
                <div class="m-auto d-flex">
                  <a href="{% url 'shop:product-details' product.id %}" 
                     class="add-to-cart d-flex justify-content-center align-items-center text-center">
                    <span><i class="ion-ios-menu"></i></span>
                  </a>
                  <a href="{% url 'cart:add_to_cart' product.id %}" 
                     class="buy-now d-flex justify-content-center align-items-center mx-1">
                    <span><i class="ion-ios-cart"></i></span>
                  </a>
                  <a href="#" class="heart d-flex justify-content-center align-items-center">
                    <span><i class="ion-ios-heart"></i></span>
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      {% else %}
        <div class="col-12 text-center">
          <div class="alert alert-info">
            <h4><i class="fas fa-info-circle"></i> Discover Our Products</h4>
            <p class="mb-3">Browse our amazing collection of quality products</p>
            <a href="{% url 'shop:shop' %}" class="btn btn-primary btn-lg">
              <i class="fas fa-store me-2"></i>Browse All Products
            </a>
          </div>
        </div>
      {% endif %}
    </div>
  </div>
</section>

<!-- Testimonials Section -->
<section class="ftco-section testimony-section">
  <div class="container">
    <div class="row justify-content-center mb-5 pb-3">
      <div class="col-md-7 heading-section ftco-animate text-center">
        <span class="subheading">Testimony</span>
        <h2 class="mb-4">Our satisfied customer says</h2>
        <p>These are some of the Reviews made by our customers</p>
      </div>
    </div>
    <div class="row ftco-animate">
      <div class="col-md-12">
        <div class="carousel-testimony owl-carousel">
          <div class="item">
            <div class="testimony-wrap p-4 pb-5">
              <div class="user-img mb-5" style="background-image: url({% static 'images/person1.jpg' %})">
                <span class="quote d-flex align-items-center justify-content-center">
                  <i class="icon-quote-left"></i>
                </span>
              </div>
              <div class="text text-center">
                <p class="mb-5 pl-4 line">
                  Campus Shoppy has changed completely the way that we carry out our online shopping here in Maseno University
                </p>
                <p class="name">Joshua Mwangari</p>
                <span class="position">Shop Owner</span>
              </div>
            </div>
          </div>
          <div class="item">
            <div class="testimony-wrap p-4 pb-5">
              <div class="user-img mb-5" style="background-image: url({% static 'images/person2.jpg' %})">
                <span class="quote d-flex align-items-center justify-content-center">
                  <i class="icon-quote-left"></i>
                </span>
              </div>
              <div class="text text-center">
                <p class="mb-5 pl-4 line">
                  I nowadays don't struggle or think of how i am going to make orders online. Campus Shoppy imenisort!
                </p>
                <p class="name">Brenda Atieno</p>
                <span class="position">Customer</span>
              </div>
            </div>
          </div>
          <div class="item">
            <div class="testimony-wrap p-4 pb-5">
              <div class="user-img mb-5" style="background-image: url({% static 'images/person1.jpg' %})">
                <span class="quote d-flex align-items-center justify-content-center">
                  <i class="icon-quote-left"></i>
                </span>
              </div>
              <div class="text text-center">
                <p class="mb-5 pl-4 line">
                  Before Campus Shoppy we had a hard time because we had to order all of the items from Kisumu and wait until they are delivered by a Matatu
                </p>
                <p class="name">Morris Ojwang</p>
                <span class="position">Maseno Business Owner</span>
              </div>
            </div>
          </div>
          <div class="item">
            <div class="testimony-wrap p-4 pb-5">
              <div class="user-img mb-5" style="background-image: url({% static 'images/person1.jpg' %})">
                <span class="quote d-flex align-items-center justify-content-center">
                  <i class="icon-quote-left"></i>
                </span>
              </div>
              <div class="text text-center">
                <p class="mb-5 pl-4 line">
                  We are actually happy as a School finding the creativity from our own students
                </p>
                <p class="name">Solomon Nyabundi</p>
                <span class="position">Faculty Member</span>
              </div>
            </div>
          </div>
          <div class="item">
            <div class="testimony-wrap p-4 pb-5">
              <div class="user-img mb-5" style="background-image: url({% static 'images/person2.jpg' %})">
                <span class="quote d-flex align-items-center justify-content-center">
                  <i class="icon-quote-left"></i>
                </span>
              </div>
              <div class="text text-center">
                <p class="mb-5 pl-4 line">
                  It is actually an inspiration to the other students from our campus and we appreciate Campus Shoppy for the good work they are doing.
                </p>
                <p class="name">Joyce Lilian</p>
                <span class="position">Faculty Member</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Newsletter Section -->
<hr />
<section class="ftco-section ftco-no-pt ftco-no-pb py-5 bg-light">
  <div class="container py-4">
    <div class="row d-flex justify-content-center py-5">
      <div class="col-md-6">
        <h2 style="font-size: 22px" class="mb-0">Subscribe to our Newsletter</h2>
        <span>Get e-mail updates about our latest shops and special offers</span>
      </div>
      <div class="col-md-6 d-flex align-items-center">
        <form class="subscribe-form" method="POST">
          <div class="form-group d-flex">
            {% csrf_token %}
            <input type="email" name="email" class="form-control" placeholder="Enter your email" required>
            <input type="submit" value="Subscribe" class="submit px-3" />
          </div>
        </form>
      </div>
    </div>
  </div>
</section>

<!-- Mobile Optimization Styles -->
<style>
/* Fix mobile scrolling and carousel display */
* {
  box-sizing: border-box;
}

body {
  overflow-x: hidden;
  width: 100%;
  margin: 0;
  padding: 0;
}

/* Hero section mobile fixes */
.hero {
  position: relative;
  overflow: hidden;
  width: 100%;
  max-width: 100vw;
}

.home-slider {
  width: 100%;
  max-width: 100vw;
  overflow: hidden;
}

.slider-item {
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  min-height: 60vh;
  display: flex;
  align-items: center;
  width: 100%;
  max-width: 100vw;
  position: relative;
}

.overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.4);
  z-index: 1;
}

.slider-text {
  position: relative;
  z-index: 2;
  color: white;
  width: 100%;
  padding: 1rem;
}

/* Mobile-first responsive design */
@media (max-width: 768px) {
  .hero {
    min-height: 50vh;
    max-height: 50vh;
  }
  
  .slider-item {
    min-height: 50vh;
    max-height: 50vh;
    background-size: cover;
    background-position: center;
    background-attachment: scroll;
  }
  
  .slider-text {
    padding: 0.5rem;
  }
  
  .slider-text h1 {
    font-size: 1.8rem;
    line-height: 1.2;
    margin-bottom: 0.5rem;
  }
  
  .slider-text .subheading {
    font-size: 1rem;
    line-height: 1.3;
    margin-bottom: 1rem;
  }
  
  .slider-text .btn {
    margin: 0.25rem;
    padding: 0.5rem 1rem;
    font-size: 0.9rem;
    display: block;
    width: 100%;
    margin-bottom: 0.5rem;
  }
  
  .category-wrap {
    min-height: 200px;
    max-height: 200px;
    margin-bottom: 1rem;
  }
  
  .category-wrap-2 {
    min-height: 300px;
    max-height: 300px;
  }
  
  .testimony-wrap {
    padding: 1rem;
  }
  
  .subscribe-form {
    flex-direction: column;
  }
  
  .subscribe-form .form-control {
    margin-bottom: 0.5rem;
  }
  
  /* Fix container overflow */
  .container {
    max-width: 100%;
    padding-left: 1rem;
    padding-right: 1rem;
  }
  
  /* Fix row overflow */
  .row {
    margin-left: 0;
    margin-right: 0;
  }
  
  .col-md-6, .col-md-8, .col-md-4 {
    padding-left: 0.5rem;
    padding-right: 0.5rem;
  }
}

@media (max-width: 576px) {
  .hero {
    min-height: 40vh;
    max-height: 40vh;
  }
  
  .slider-item {
    min-height: 40vh;
    max-height: 40vh;
  }
  
  .slider-text h1 {
    font-size: 1.5rem;
    line-height: 1.1;
  }
  
  .slider-text .subheading {
    font-size: 0.9rem;
    line-height: 1.2;
  }
  
  .slider-text .btn {
    padding: 0.4rem 0.8rem;
    font-size: 0.8rem;
  }
  
  .category-wrap {
    min-height: 150px;
    max-height: 150px;
  }
  
  .category-wrap-2 {
    min-height: 250px;
    max-height: 250px;
  }
  
  /* Ensure no horizontal scroll */
  .container {
    padding-left: 0.5rem;
    padding-right: 0.5rem;
  }
  
  .col-md-6, .col-md-8, .col-md-4 {
    padding-left: 0.25rem;
    padding-right: 0.25rem;
  }
}

/* Category section improvements */
.category-wrap {
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  border-radius: 0.5rem;
  overflow: hidden;
  position: relative;
  width: 100%;
}

.category-wrap::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg, rgba(0,0,0,0.6), rgba(0,0,0,0.3));
  z-index: 1;
}

.category-wrap .text {
  position: relative;
  z-index: 2;
  color: white;
  padding: 1rem;
}

.category-wrap-2 {
  background-size: cover;
  background-position: center;
  background-repeat: no-repeat;
  border-radius: 0.5rem;
  overflow: hidden;
  position: relative;
  width: 100%;
}

.category-wrap-2::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(45deg, rgba(0,0,0,0.6), rgba(0,0,0,0.3));
  z-index: 1;
}

.category-wrap-2 .text {
  position: relative;
  z-index: 2;
  color: white;
  padding: 1rem;
}

/* Fix owl carousel mobile issues */
.owl-carousel {
  width: 100%;
  max-width: 100vw;
}

.owl-stage-outer {
  overflow: hidden;
  width: 100%;
}

.owl-stage {
  width: 100%;
}

.owl-item {
  width: 100%;
}

/* Ensure proper scrolling */
html {
  overflow-x: hidden;
}

body {
  overflow-x: hidden;
  width: 100%;
}

/* Fix any elements that might cause horizontal scroll */
img {
  max-width: 100%;
  height: auto;
}

.container-fluid {
  padding-left: 1rem;
  padding-right: 1rem;
}

/* Mobile navigation fixes */
@media (max-width: 768px) {
  .navbar-collapse {
    max-height: none;
    overflow: visible;
  }
  
  .navbar-nav {
    flex-direction: column;
  }
  
  .nav-item {
    width: 100%;
    text-align: center;
  }
}

/* Carousel Navigation Styling */
.carousel-nav {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  width: 100%;
  display: flex;
  justify-content: space-between;
  padding: 0 2rem;
  z-index: 10;
}

.carousel-prev,
.carousel-next {
  background: rgba(255, 255, 255, 0.8);
  border: none;
  border-radius: 50%;
  width: 50px;
  height: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  color: #333;
  font-size: 1.2rem;
}

.carousel-prev:hover,
.carousel-next:hover {
  background: rgba(255, 255, 255, 1);
  transform: scale(1.1);
}

.carousel-dots {
  position: absolute;
  bottom: 2rem;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 0.5rem;
  z-index: 10;
}

.dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.5);
  cursor: pointer;
  transition: all 0.3s ease;
}

.dot.active {
  background: rgba(255, 255, 255, 1);
  transform: scale(1.2);
}

.dot:hover {
  background: rgba(255, 255, 255, 0.8);
}

/* Mobile carousel navigation */
@media (max-width: 768px) {
  .carousel-nav {
    padding: 0 1rem;
  }
  
  .carousel-prev,
  .carousel-next {
    width: 40px;
    height: 40px;
    font-size: 1rem;
  }
  
  .carousel-dots {
    bottom: 1rem;
  }
  
  .dot {
    width: 10px;
    height: 10px;
  }
}
</style>

<!-- Simple Carousel JavaScript -->
<script>
// Simple carousel implementation
let currentSlideIndex = 0;
const slides = document.querySelectorAll('.slider-item');
const dots = document.querySelectorAll('.dot');

// Initialize carousel when page loads
document.addEventListener('DOMContentLoaded', function() {
  console.log('Carousel initializing...');
  
  // Show first slide
  if (slides.length > 0) {
    showSlide(0);
    
    // Auto-advance slides every 5 seconds
    setInterval(() => {
      nextSlide();
    }, 5000);
  }
  
  // Fix mobile viewport
  const viewport = document.querySelector('meta[name="viewport"]');
  if (viewport) {
    viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
  }
  
  // Fix mobile scrolling
  document.body.style.overflowX = 'hidden';
  document.documentElement.style.overflowX = 'hidden';
  
  console.log('Carousel initialized successfully');
});

// Show specific slide
function showSlide(index) {
  if (slides.length === 0) return;
  
  // Hide all slides
  slides.forEach((slide, i) => {
    slide.style.display = i === index ? 'flex' : 'none';
    slide.classList.toggle('active', i === index);
  });
  
  // Update dots
  dots.forEach((dot, i) => {
    dot.classList.toggle('active', i === index);
  });
  
  currentSlideIndex = index;
}

// Next slide
function nextSlide() {
  const nextIndex = (currentSlideIndex + 1) % slides.length;
  showSlide(nextIndex);
}

// Previous slide
function prevSlide() {
  const prevIndex = (currentSlideIndex - 1 + slides.length) % slides.length;
  showSlide(prevIndex);
}

// Change slide with navigation buttons
function changeSlide(direction) {
  if (direction === 1) {
    nextSlide();
  } else {
    prevSlide();
  }
}

// Go to specific slide with dots
function currentSlide(index) {
  showSlide(index - 1);
}

// Touch/swipe support for mobile
let startX = 0;
let endX = 0;

document.addEventListener('touchstart', function(e) {
  startX = e.touches[0].clientX;
});

document.addEventListener('touchend', function(e) {
  endX = e.changedTouches[0].clientX;
  handleSwipe();
});

function handleSwipe() {
  const threshold = 50;
  const diff = startX - endX;
  
  if (Math.abs(diff) > threshold) {
    if (diff > 0) {
      nextSlide(); // Swipe left - next slide
    } else {
      prevSlide(); // Swipe right - previous slide
    }
  }
}
</script>
{% endblock %}
